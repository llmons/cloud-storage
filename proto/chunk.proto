syntax = "proto3";

import "google/api/annotations.proto";

option go_package = "cloud_storage/api/chunk/v1;v1";

// ---------------------- Service 定义 ----------------------

service chunk {
  // 文件上传前基本信息处理
  rpc FileUploadPrepare(FileUploadPrepareRequest) returns (FileUploadPrepareReply) {
    option (google.api.http) = {
      post: "/file/upload/prepare"
      body: "*"
    };
  }

  // 文件分片上传
  rpc FileUploadChunk(FileUploadChunkRequest) returns (FileUploadChunkReply) {
    option (google.api.http) = {
      post: "/file/upload/chunk"
      body: "*"
    };
  }

  // 文件分片上传完成
  rpc FileUploadChunkComplete(FileUploadChunkCompleteRequest) returns (FileUploadChunkCompleteReply) {
    option (google.api.http) = {
      post: "/file/upload/chunk/complete"
      body: "*"
    };
  }
}

// ---------------------- Messages 定义 ----------------------

message FileUploadChunkCompleteRequest {
  string md5 = 1;
  string name = 2;
  string ext = 3;
  int64 size = 4;
  string key = 5;
  string upload_id = 6;
  repeated CosObject cos_objects = 7;
}

message CosObject {
  int32 part_number = 1;
  string etag = 2;
}

message FileUploadChunkCompleteReply {
  string identity = 1;
}

message FileUploadChunkRequest {
  string key = 1;
  string upload_id = 2;
  int32 part_number = 3;
}

message FileUploadChunkReply {
  string etag = 1;
}

message FileUploadPrepareRequest {
  string md5 = 1;
  string name = 2;
  string ext = 3;
}

message FileUploadPrepareReply {
  string identity = 1;
  string upload_id = 2;
  string key = 3;
}
